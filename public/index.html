<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
     <script id="zsiqscript" src="https://salesiq.zohopublic.in/widget?wc=siq432810251110ab8fa1526b5b918a80f6ca4a6de27ee9e3572852a9858c9dc685" defer></script>

   <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
     <script id="zsiqscript" src="https://salesiq.zohopublic.in/widget?wc=siq432810251110ab8fa1526b5b918a80f6ca4a6de27ee9e3572852a9858c9dc685" defer></script>

    <script>
    var $zoho = $zoho || {};
    $zoho.salesiq = $zoho.salesiq || {
        widgetcode: "siq432810251110ab8fa1526b5b918a80f6ca4a6de27ee9e3572852a9858c9dc685",
        loadImmediately: true
    };
    var d = document;
    var s = d.createElement("script");
    s.type = "text/javascript";
    s.id = "zsiqscript";
    s.defer = true;
    s.src = "salesiq.zohopublic.in";
    var t = d.getElementsByTagName("script")[0]; // Corrected line to get the first script
    t.parentNode.insertBefore(s, t);
</script>

<!-- Place your custom logic AFTER the snippet above -->
<script>
    // This will run reliably once SalesIQ is ready
    $zoho.salesiq.ready = function() {
        var visitorId = $zoho.salesiq.visitor.uniqueuserid();
        console.log("SUCCESS: SalesIQ Visitor ID is: " + visitorId);
    };
</script>
</head> 
<body>

    <input type="email" id="email" required placeholder="Email">
    <input type="password" id="password" required placeholder="Password">
    <button type="submit" id ="but">Login</button>
    <div id="res"></div>
    <div id="response"></div> 


 


<script>
    // **1. Function to Get the Visitor ID from SalesIQ**
    function getZohoVisitorId() {
    return new Promise((resolve) => {
        // Wait for Zoho SalesIQ to be ready
        $zoho.salesiq.ready(function() {
            try {
                let visitor = $zoho.salesiq.visitor.get();
                console.log("Visitor Info:", visitor);
                resolve(visitor.id);
            } catch (error) {
                console.error("Error retrieving visitor ID:", error);
                resolve(null);
            }
        });
    });
}


    // **2. Function to Handle Login and Send Data**
    document.getElementById('but').addEventListener('click',async()=> {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        //const visitorId = await getZohoVisitorId();
        // console.log(visitorId);
        // document.getElementById('res').textContent = visitorId;

        // if (!visitorId) {
        //     alert("Could not retrieve Zoho SalesIQ Visitor ID. Ensure the widget is loaded.");
        //     return;
        // }

        const response = await fetch('https://parky-zobot-cliqtrix.onrender.com/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: email,
                password: password,
                // **THIS IS THE CRITICAL LINE:**
                //zoho_visitor_id: visitorId 
            })
        });

        const data = await response.json();
        if (data.botToken) {
            localStorage.setItem('botToken', data.botToken);
            alert('Login successful! Bot key saved to DB.');
            // Note: We don't store the botKey in local storage.
        } else {
            alert('Login failed: ' + data.message);
        }
    })
</script>

    
</body>
</html>